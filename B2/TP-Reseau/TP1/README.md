# TP1 : Maîtrise réseau du poste

- [TP1 : Maîtrise réseau du poste](#tp1--maîtrise-réseau-du-poste)
- [I. Basics](#i-basics)
- [II. Go further](#ii-go-further)
- [III. Le requin](#iii-le-requin)

# I. Basics

☀️ **Carte réseau WiFi**


- l'adresse MAC de votre carte WiFi

```bash
[ahliko@ahliko-PC ~]$ ip a show wlp4s0 | awk '/ether/ {print $2}'                                       ✔ 
e0:0a:f6:6d:2d:fd
```

- l'adresse IP de votre carte WiFi

```bash
[ahliko@ahliko-PC ~]$ ip a show wlp4s0 | awk '/inet/ {print $2}' | head -n 1                            ✔ 
10.33.64.136/20
```
- le masque de sous-réseau du réseau LAN auquel vous êtes connectés en WiFi
    - en notation CIDR, par exemple `/16`
```bash
[ahliko@ahliko-PC ~]$ ip a show wlp4s0 | awk '/inet/ {print $2}' | head -n 1                            ✔ 
10.33.64.136/20
```

    - ET en notation décimale, par exemple `255.255.0.0`
```bash
[ahliko@ahliko-PC ~]$ sipcalc 10.33.64.136/20 | grep 'Network mask' | head -n 1                         ✔ 
Network mask		- 255.255.240.0
```

---

☀️ **Déso pas déso**

Pas besoin d'un terminal là, juste une feuille, ou votre tête, ou un tool qui calcule tout hihi. Déterminer...

- l'adresse de réseau du LAN auquel vous êtes connectés en WiFi
```bash
[ahliko@ahliko-PC ~]$ sipcalc 10.33.64.136/20 | grep 'Network range' | awk '/-/ {print $4}'             ✔ 
10.33.64.0
```

- l'adresse de broadcast
```bash
[ahliko@ahliko-PC ~]$ sipcalc 10.33.64.136/20 | grep 'Broadcast'                                        ✔ 
Broadcast address	- 10.33.79.255
```

- le nombre d'adresses IP disponibles dans ce réseau
```bash
[ahliko@ahliko-PC ~]$ sipcalc 10.33.64.136/20 | grep 'Addresses in network'                             ✔ 
Addresses in network	- 4096
```

---

☀️ **Hostname**

- déterminer le hostname de votre PC
```bash
[ahliko@ahliko-PC ~]$ hostname                                                                          ✔ 
ahliko-PC
```

---

☀️ **Passerelle du réseau**

Déterminer...

- l'adresse IP de la passerelle du réseau
```bash
[ahliko@ahliko-PC ~]$ ip n s | awk '// {print $1}'
10.33.79.254
```
- l'adresse MAC de la passerelle du réseau
```bash
[ahliko@ahliko-PC ~]$ ip n s | awk '// {print $5}'
7c:5a:1c:d3:d8:76 
```

---

☀️ **Serveur DHCP et DNS**

- l'adresse IP du serveur DHCP qui vous a filé une IP
```bash
[ahliko@ahliko-PC ~]$ ip n s | awk '// {print $1}'
10.33.79.254
```
- l'adresse IP du serveur DNS que vous utilisez quand vous allez sur internet
```bash
[ahliko@ahliko-PC ~]$ cat /etc/resolv.conf 
# Generated by NetworkManager
nameserver 8.8.8.8
nameserver 1.1.1.1
```

---

☀️ **Table de routage**

- dans votre table de routage, laquelle est la route par défaut
```bash
[ahliko@ahliko-PC ~]$ ip route show | grep default
default via 10.33.79.254 dev wlp4s0 proto dhcp src 10.33.64.136 metric 600 
```

---

# II. Go further

---

☀️ **Hosts ?**

- faites en sorte que pour votre PC, le nom `b2.hello.vous` corresponde à l'IP `1.1.1.1`
```bash
[ahliko@ahliko-PC ~]$ cat /etc/hosts
# Standard host addresses
127.0.0.1  localhost
::1        localhost ip6-localhost ip6-loopback
ff02::1    ip6-allnodes
ff02::2    ip6-allrouters
# This host address
127.0.1.1  ahliko-PC
1.1.1.1 b2.hello.vous
```
- prouvez avec un `ping b2.hello.vous` que ça ping bien `1.1.1.1`

```bash
[ahliko@ahliko-PC ~]$ ping b2.hello.vous
PING b2.hello.vous (1.1.1.1) 56(84) octets de données.
64 octets de b2.hello.vous (1.1.1.1) : icmp_seq=1 ttl=57 temps=15.8 ms
64 octets de b2.hello.vous (1.1.1.1) : icmp_seq=2 ttl=57 temps=11.6 ms
^C
--- statistiques ping b2.hello.vous ---
2 paquets transmis, 2 reçus, 0% packet loss, time 1001ms
rtt min/avg/max/mdev = 11.615/13.722/15.829/2.107 ms
```

---

☀️ **Go mater une vidéo youtube et déterminer, pendant qu'elle tourne...**



![Sans titre.png](..%2F..%2F..%2F..%2F..%2FImages%2FSans%20titre.png)
- l'adresse IP du serveur auquel vous êtes connectés pour regarder la vidéo ===> 1
- le port du serveur auquel vous êtes connectés ===> 3
- le port que votre PC a ouvert en local pour se connecter au port du serveur distant ====> 2

---

☀️ **Requêtes DNS**



- à quelle adresse IP correspond le nom de domaine `www.ynov.com`

```bash
[ahliko@ahliko-PC ~]$ drill www.ynov.com
;; ->>HEADER<<- opcode: QUERY, rcode: NOERROR, id: 39956
;; flags: qr rd ra ; QUERY: 1, ANSWER: 3, AUTHORITY: 0, ADDITIONAL: 0 
;; QUESTION SECTION:
;; www.ynov.com.	IN	A

;; ANSWER SECTION:
www.ynov.com.	154	IN	A	172.67.74.226
www.ynov.com.	154	IN	A	104.26.11.233
www.ynov.com.	154	IN	A	104.26.10.233

;; AUTHORITY SECTION:

;; ADDITIONAL SECTION:

;; Query time: 19 msec
;; SERVER: 1.1.1.1
;; WHEN: Thu Oct 12 12:15:31 2023
;; MSG SIZE  rcvd: 78
```

- à quel nom de domaine correspond l'IP `174.43.238.89`

```bash
[ahliko@ahliko-PC ~]$ drill -x 174.43.238.89
;; ->>HEADER<<- opcode: QUERY, rcode: NOERROR, id: 64183
;; flags: qr rd ra ; QUERY: 1, ANSWER: 1, AUTHORITY: 0, ADDITIONAL: 0 
;; QUESTION SECTION:
;; 89.238.43.174.in-addr.arpa.	IN	PTR

;; ANSWER SECTION:
89.238.43.174.in-addr.arpa.	7200	IN	PTR	89.sub-174-43-238.myvzw.com.
```

---

☀️ **Hop hop hop**


- par combien de machines vos paquets passent quand vous essayez de joindre `www.ynov.com`
```bash
[ahliko@ahliko-PC ~]$ traceroute www.ynov.com
traceroute to www.ynov.com (104.26.10.233), 30 hops max, 60 byte packets
 1  _gateway (10.33.79.254)  4.301 ms  4.238 ms  4.076 ms
 2  145.117.7.195.rev.sfr.net (195.7.117.145)  2.358 ms  2.335 ms  2.318 ms
 3  * * *
 4  196.224.65.86.rev.sfr.net (86.65.224.196)  2.233 ms  2.215 ms  2.198 ms
 5  68.150.6.194.rev.sfr.net (194.6.150.68)  12.550 ms  12.534 ms 12.148.6.194.rev.sfr.net (194.6.148.12)  12.511 ms
 6  68.150.6.194.rev.sfr.net (194.6.150.68)  12.492 ms 12.148.6.194.rev.sfr.net (194.6.148.12)  10.335 ms  10.324 ms
 7  141.101.67.48 (141.101.67.48)  10.317 ms  24.767 ms  24.747 ms
 8  141.101.67.54 (141.101.67.54)  16.919 ms 172.71.132.4 (172.71.132.4)  19.646 ms 141.101.67.54 (141.101.67.54)  10.615 ms
 9  104.26.10.233 (104.26.10.233)  10.562 ms  43.940 ms  43.867 ms
```

---

☀️ **IP publique**

- l'adresse IP publique de la passerelle du réseau (le routeur d'YNOV donc si vous êtes dans les locaux d'YNOV quand vous faites le TP)
```bash
[ahliko@ahliko-PC ~]$ curl ifconfig.me
195.7.117.146
```

---

☀️ **Scan réseau**

- combien il y a de machines dans le LAN auquel vous êtes connectés
  (nmap)
```bash

```

# III. Le requin

Faites chauffer Wireshark. Pour chaque point, je veux que vous me livrez une capture Wireshark, format `.pcap` donc.

Faites *clean* 🧹, vous êtes des grands now :

- livrez moi des captures réseau avec uniquement ce que je demande et pas 40000 autres paquets autour
    - vous pouvez sélectionner seulement certains paquets quand vous enregistrez la capture dans Wireshark
- stockez les fichiers `.pcap` dans le dépôt git et côté rendu Markdown, vous me faites un lien vers le fichier, c'est cette syntaxe :

```markdown
[Lien vers capture ARP](./captures/arp.pcap)
```

---

☀️ **Capture ARP**

- 📁 fichier `arp.pcap`
- capturez un échange ARP entre votre PC et la passerelle du réseau

> Si vous utilisez un filtre Wireshark pour mieux voir ce trafic, précisez-le moi dans le compte-rendu.

---

☀️ **Capture DNS**

- 📁 fichier `dns.pcap`
- capturez une requête DNS vers le domaine de votre choix et la réponse
- vous effectuerez la requête DNS en ligne de commande

> Si vous utilisez un filtre Wireshark pour mieux voir ce trafic, précisez-le moi dans le compte-rendu.

---

☀️ **Capture TCP**

- 📁 fichier `tcp.pcap`
- effectuez une connexion qui sollicite le protocole TCP
- je veux voir dans la capture :
    - un 3-way handshake
    - un peu de trafic
    - la fin de la connexion TCP

> Si vous utilisez un filtre Wireshark pour mieux voir ce trafic, précisez-le moi dans le compte-rendu.

---

![Packet sniffer](img/wireshark.jpg)

> *Je sais que je vous l'ai déjà servi l'an dernier lui, mais j'aime trop ce meme hihi 🐈*